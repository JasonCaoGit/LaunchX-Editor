{"version":3,"sources":["file:///Users/kw/github/monaco-editor-core/out-editor-esm/vs/editor/contrib/placeholderText/browser/placeholderTextContribution.ts","vs/editor/contrib/placeholderText/browser/placeholderTextContribution.ts"],"names":[],"mappings":"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","file":"placeholderTextContribution.js","sourceRoot":"file:///Users/kw/github/monaco-editor-core/out-editor-esm","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h } from '../../../../base/browser/dom.js';\nimport { structuralEquals } from '../../../../base/common/equals.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, constObservable, DebugOwner, derivedObservableWithCache, derivedOpts, derivedWithStore, IObservable, IReader } from '../../../../base/common/observable.js';\nimport { ICodeEditor } from '../../../browser/editorBrowser.js';\nimport { observableCodeEditor } from '../../../browser/observableCodeEditor.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport { IEditorContribution } from '../../../common/editorCommon.js';\n\n/**\n * Use the editor option to set the placeholder text.\n*/\nexport class PlaceholderTextContribution extends Disposable implements IEditorContribution {\n\tpublic static get(editor: ICodeEditor): PlaceholderTextContribution {\n\t\treturn editor.getContribution<PlaceholderTextContribution>(PlaceholderTextContribution.ID)!;\n\t}\n\n\tpublic static readonly ID = 'editor.contrib.placeholderText';\n\tprivate readonly _editorObs = observableCodeEditor(this._editor);\n\n\tprivate readonly _placeholderText = this._editorObs.getOption(EditorOption.placeholder);\n\n\tprivate readonly _state = derivedOpts<{ placeholder: string } | undefined>({ owner: this, equalsFn: structuralEquals }, reader => {\n\t\tconst p = this._placeholderText.read(reader);\n\t\tif (!p) { return undefined; }\n\t\tif (!this._editorObs.valueIsEmpty.read(reader)) { return undefined; }\n\t\treturn { placeholder: p };\n\t});\n\n\tprivate readonly _shouldViewBeAlive = isOrWasTrue(this, reader => this._state.read(reader)?.placeholder !== undefined);\n\n\tprivate readonly _view = derivedWithStore((reader, store) => {\n\t\tif (!this._shouldViewBeAlive.read(reader)) { return; }\n\n\t\tconst element = h('div.editorPlaceholder');\n\n\t\tstore.add(autorun(reader => {\n\t\t\tconst data = this._state.read(reader);\n\t\t\tconst shouldBeVisibile = data?.placeholder !== undefined;\n\t\t\telement.root.style.display = shouldBeVisibile ? 'block' : 'none';\n\t\t\telement.root.innerText = data?.placeholder ?? '';\n\t\t}));\n\t\tstore.add(autorun(reader => {\n\t\t\tconst info = this._editorObs.layoutInfo.read(reader);\n\t\t\telement.root.style.left = `${info.contentLeft}px`;\n\t\t\telement.root.style.width = (info.contentWidth - info.verticalScrollbarWidth) + 'px';\n\t\t\telement.root.style.top = `${this._editor.getTopForLineNumber(0)}px`;\n\t\t}));\n\t\tstore.add(autorun(reader => {\n\t\t\telement.root.style.fontFamily = this._editorObs.getOption(EditorOption.fontFamily).read(reader);\n\t\t\telement.root.style.fontSize = this._editorObs.getOption(EditorOption.fontSize).read(reader) + 'px';\n\t\t\telement.root.style.lineHeight = this._editorObs.getOption(EditorOption.lineHeight).read(reader) + 'px';\n\t\t}));\n\t\tstore.add(this._editorObs.createOverlayWidget({\n\t\t\tallowEditorOverflow: false,\n\t\t\tminContentWidthInPx: constObservable(0),\n\t\t\tposition: constObservable(null),\n\t\t\tdomNode: element.root,\n\t\t}));\n\t});\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t) {\n\t\tsuper();\n\t\tthis._view.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nfunction isOrWasTrue(owner: DebugOwner, fn: (reader: IReader) => boolean): IObservable<boolean> {\n\treturn derivedObservableWithCache<boolean>(owner, (reader, lastValue) => {\n\t\tif (lastValue === true) { return true; }\n\t\treturn fn(reader);\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h } from '../../../../base/browser/dom.js';\nimport { structuralEquals } from '../../../../base/common/equals.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, constObservable, DebugOwner, derivedObservableWithCache, derivedOpts, derivedWithStore, IObservable, IReader } from '../../../../base/common/observable.js';\nimport { ICodeEditor } from '../../../browser/editorBrowser.js';\nimport { observableCodeEditor } from '../../../browser/observableCodeEditor.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport { IEditorContribution } from '../../../common/editorCommon.js';\n\n/**\n * Use the editor option to set the placeholder text.\n*/\nexport class PlaceholderTextContribution extends Disposable implements IEditorContribution {\n\tpublic static get(editor: ICodeEditor): PlaceholderTextContribution {\n\t\treturn editor.getContribution<PlaceholderTextContribution>(PlaceholderTextContribution.ID)!;\n\t}\n\n\tpublic static readonly ID = 'editor.contrib.placeholderText';\n\tprivate readonly _editorObs = observableCodeEditor(this._editor);\n\n\tprivate readonly _placeholderText = this._editorObs.getOption(EditorOption.placeholder);\n\n\tprivate readonly _state = derivedOpts<{ placeholder: string } | undefined>({ owner: this, equalsFn: structuralEquals }, reader => {\n\t\tconst p = this._placeholderText.read(reader);\n\t\tif (!p) { return undefined; }\n\t\tif (!this._editorObs.valueIsEmpty.read(reader)) { return undefined; }\n\t\treturn { placeholder: p };\n\t});\n\n\tprivate readonly _shouldViewBeAlive = isOrWasTrue(this, reader => this._state.read(reader)?.placeholder !== undefined);\n\n\tprivate readonly _view = derivedWithStore((reader, store) => {\n\t\tif (!this._shouldViewBeAlive.read(reader)) { return; }\n\n\t\tconst element = h('div.editorPlaceholder');\n\n\t\tstore.add(autorun(reader => {\n\t\t\tconst data = this._state.read(reader);\n\t\t\tconst shouldBeVisibile = data?.placeholder !== undefined;\n\t\t\telement.root.style.display = shouldBeVisibile ? 'block' : 'none';\n\t\t\telement.root.innerText = data?.placeholder ?? '';\n\t\t}));\n\t\tstore.add(autorun(reader => {\n\t\t\tconst info = this._editorObs.layoutInfo.read(reader);\n\t\t\telement.root.style.left = `${info.contentLeft}px`;\n\t\t\telement.root.style.width = (info.contentWidth - info.verticalScrollbarWidth) + 'px';\n\t\t\telement.root.style.top = `${this._editor.getTopForLineNumber(0)}px`;\n\t\t}));\n\t\tstore.add(autorun(reader => {\n\t\t\telement.root.style.fontFamily = this._editorObs.getOption(EditorOption.fontFamily).read(reader);\n\t\t\telement.root.style.fontSize = this._editorObs.getOption(EditorOption.fontSize).read(reader) + 'px';\n\t\t\telement.root.style.lineHeight = this._editorObs.getOption(EditorOption.lineHeight).read(reader) + 'px';\n\t\t}));\n\t\tstore.add(this._editorObs.createOverlayWidget({\n\t\t\tallowEditorOverflow: false,\n\t\t\tminContentWidthInPx: constObservable(0),\n\t\t\tposition: constObservable(null),\n\t\t\tdomNode: element.root,\n\t\t}));\n\t});\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t) {\n\t\tsuper();\n\t\tthis._view.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nfunction isOrWasTrue(owner: DebugOwner, fn: (reader: IReader) => boolean): IObservable<boolean> {\n\treturn derivedObservableWithCache<boolean>(owner, (reader, lastValue) => {\n\t\tif (lastValue === true) { return true; }\n\t\treturn fn(reader);\n\t});\n}\n"]}